# Pytest Configuration for Lumen RPG (LES 2025)
# ===============================================
#
# Purpose
# -------
# Centralized pytest configuration for the Lumen RPG test suite.
# Supports both unit tests (fast, isolated) and integration tests
# (using testcontainers for real database/redis).
#
# LES 2025 Compliance
# -------------------
# - Async support via pytest-asyncio
# - Structured test organization (unit/ vs integration/)
# - Coverage tracking with explicit source paths
# - Timeout protection for hanging tests
# - Strict marker enforcement
#
# Usage
# -----
# Run all tests:           pytest
# Run unit tests only:     pytest tests/unit
# Run integration tests:   pytest tests/integration
# Run with coverage:       pytest --cov=src --cov-report=html
# Run specific marker:     pytest -m unit

[pytest]
# Test Discovery
# --------------
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Asyncio Support
# ---------------
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Output Configuration
# --------------------
# -v: verbose output
# -ra: show summary of all test outcomes (passed, failed, skipped, etc.)
# --tb=short: shorter traceback format
# --strict-markers: fail on unknown markers
addopts =
    -v
    -ra
    --tb=short
    --strict-markers
    --asyncio-mode=auto

# Test Markers
# ------------
# Markers allow you to categorize and selectively run tests
markers =
    unit: Fast unit tests with no external dependencies (mocked services, database, etc.)
    integration: Integration tests requiring real database/redis (uses testcontainers)
    slow: Tests that take more than 1 second to run
    smoke: Smoke tests that verify basic functionality (run before deployment)
    domain: Tests for domain models and business logic
    service: Tests for service layer
    repository: Tests for repository layer
    cog: Tests for Discord cog layer
    database: Tests that require database access
    redis: Tests that require Redis access

# Coverage Configuration
# ----------------------
[coverage:run]
source = src
omit =
    */tests/*
    */__pycache__/*
    */venv/*
    */.venv/*
    */migrations/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
    @abc.abstractmethod

[coverage:html]
directory = htmlcov

# Timeout Configuration
# ---------------------
# Prevent tests from hanging indefinitely
timeout = 30
timeout_method = thread
